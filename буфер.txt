Что было исправлено

Вернули совместимость с текущим CSS главной карты

Центральной карте снова даётся класс main:

className={
  "tarot-card" + (isMain ? " main" : "")
}


Это позволяет сработать существующим стилям типа .tarot-card.main { ... }, из-за чего раньше карта визуально «пропадала» / была нулевого размера.

Убрали tarot-card-back-inner, вернули tarot-card-back

Раньше для рубашки использовался <div className="tarot-card-back-inner" />, под который не было стилей.

Теперь:

<div className="tarot-card-back" />


— что соответствует уже существующему CSS (там обычно фон рубашки, размеры, бордер и т.д.).

Сохранили бесконечную рулетку на 78 позиций

Введена константа:

const TOTAL_VIRTUAL_CARDS = 78;


clampIndex обеспечивает круговой диапазон 0..77:

function clampIndex(index) {
  const mod = index % TOTAL_VIRTUAL_CARDS;
  return mod < 0 ? mod + TOTAL_VIRTUAL_CARDS : mod;
}


Автоспин через setInterval:

useEffect(() => {
  if (!isSpinning) return;
  const id = window.setInterval(
    () => setCurrentIndex(prev => clampIndex(prev + 1)),
    80
  );
  return () => window.clearInterval(id);
}, [isSpinning]);


Связь с реальной колодой через deck + onPickCard сохранена

Подготовка колоды:

const deckArray =
  Array.isArray(deck) && deck.length > 0 ? deck : null;


Для каждого виртуального индекса берём карту из deck по модулю:

const deckIndex = virtualIndex % deckArray.length;
card = deckArray[deckIndex];


При «поимке» карты:

if (deckArray && deckArray.length > 0) {
  const deckIndex = currentIndex % deckArray.length;
  const selectedCard = deckArray[deckIndex];
  onPickCard?.(selectedCard);
}
onPick?.();
setIsSpinning(false);


Viewer-режим оставлен рабочим, как до этого

Показывает массив selectedCards горизонтальной лентой (tarot-carousel-strip).

Использует image_url или /images/tarot/back.png, учитывает is_reversed через классы:

"tarot-card-viewer" / "tarot-card-viewer-reversed";

"tarot-card-image" / "tarot-card-image-reversed".

Итог:
В ритуале теперь снова видно центральную карту, она не «исчезает» и не рушит верстку; рулетка крутится по кругу, при клике по центральной карте или кнопке срабатывают и старый onPick, и новый onPickCard (при наличии deck).
